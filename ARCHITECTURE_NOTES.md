
---

# ✅ **2. ARCHITECTURE_NOTES.md (внутренний технический документ)**

```markdown
# Avalon — Internal Architecture Notes

Этот документ служит внутренним описанием системы.  
Он нужен для постепенного накопления архитектурной информации, чтобы в будущем быстро восстанавливать контекст проекта.

---

# 1. Общая идея системы

Avalon — метамодельная ERP-платформа, где сущности, связи, формы, процессы и UI-элементы создаются без программирования.  
Основная цель — дать возможность организациям автоматизировать свои процессы через AI-помощника, используя только описания и конфигурации.

---

# 2. Архитектура верхнего уровня

Компоненты платформы:
- **Backend** — Node.js + TypeScript  
- **Frontend** — React + Vite  
- **PostgreSQL** — основная база данных  
- **Redis** — кэш, pub/sub, очереди  
- **MinIO** — S3-совместимое файловое хранилище  
- **Nginx** — reverse proxy  
- **Docker Compose** — единый стек сервисов

---

# 3. Backend

Функции backend:
- хранение и обработка метаданных моделей
- генерация API по метасущностям
- мультитеннантность
- обработка бизнес-логики
- хранение документов, файлов
- интеграция через Redis и MinIO

Слои, которые нужно документировать (когда появятся в коде):
- controllers  
- services  
- models / entities  
- metadata engine  
- process/workflow engine  
- auth / tenants  
- utils / storage

---

# 4. Frontend (React + Vite)

Функции:
- динамические формы по метаданным
- таблицы / справочники / карточки
- модули UI (склад, CRM, документы и т.п.)
- визуальный редактор сущностей
- клиент AI-помощника

Структуру фронтенда нужно будет дополнять по мере появления модулей.

---

# 5. Хранилища

### PostgreSQL
- таблицы пользователей, тенантов
- таблицы метаданных сущностей
- данные по сущностям
- логи изменений

### Redis
- кэш API
- очереди задач
- pub/sub для событий

### MinIO
- файлы документов  
- вложения  
- экспорт / импорт

---

# 6. Docker-инфраструктура

Сервисы:
- postgres
- redis
- minio
- backend
- frontend
- nginx

Все общаются через `avalon_net`.

---

# 7. Метамодель

Пока концептуально:
- Сущность (Entity)
- Поле (Field)
- Типы данных
- Связи: one2many, many2one, many2many
- UI-описания
- Валидации
- Процессы (Workflows)

AI-модуль может генерировать:
- сущности  
- поля  
- процессы  
- рекомендации  

---

# 8. Что добавлять в будущем

Когда появятся:
- структура `backend/`  
- структура `frontend/`  
- схемы таблиц  
- описание API  
- описание workflow engine  

Этот документ дополняется по мере разработки и служит «коллективной памятью» проекта.
